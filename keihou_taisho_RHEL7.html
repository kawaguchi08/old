<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=x-sjis">
<title>【DNSサーバ】iLOアラート対応</title>
</head>

<body bgcolor="white" link="black" alink="black" vlink="gray">
    <style>
        P {
            line-height: 130%;
            margin-left: 0%;
            margin-right: 0%;
        }

        A {
            text-decoration: none;
        }

            A:hover {
                text-decoration: underline;
            }
    </style>

<pre>
<font size="5"><b>
=================================================================
【DNSサービス　警報時の対応フロー(RHEL7/CentOS7～対象)】 
=================================================================

</b></font>

<font size="3"><b>【DNS関連の代表的な警報】</b></font>
<Table border>
    <tr bgcolor="#006400">
    <td><font color="white">　</font></td>
    <td><font color="white">警報</font></td>
    <td><font color="white">警報メールのSubject<br>概要</font></td>
    <td><font color="white">備考</font></td>
  </tr>

    <tr>
    <td>１</td>
    <td><b><a href="#cpu"><u><font color="#0066bb">CPU ??% OVER</font></u></a></b></td>
    <td><font color="blue">Subject:[対象サーバ] HPE Insight Management Agents Trap Alarm</font>
    <br>iLOのログイン画面にてEmbedded Flash/SD-CARDの表示を確認
    <br><font color="red">※サービス確認がOKでも2～3回警報が出続ける場合は、<a href="http://XXXX"><u><font color="#0066bb">エスカレーション</font></u></a>し<a href="#restart"><u><font color="#0066bb">プロセス再起動</font></u></a>の判断を仰いで下さい</font></td>
    <td>-</td>
  </tr>

    <tr>
    <td>２</td>
    <td><b><a href="#query"><u><font color="#0066bb">Query Count Over</font></u></a></b></td>
    <td><font color="blue">Subject:  [DNS]サーバ名 Query over !</font><br>
        1秒間に受けるquery数が閾値を超えたときに出ます　※閾値は下記<br>
        LinuxBIND(recursion yes)⇒2400、<br>LinuxBIND(recursion no)⇒3600、cachecerve⇒40000、<br>内部DNS⇒3000</td>
        </td>
    <td>・DNSBLの閾値は3000<br>・BizCITY DNSの閾値は10000</td>
  </tr>

    <tr>
    <td>３</td>
    <td><b><a href="#NG"><u><font color="#0066bb">nslookup NG</font></u></a></b>
<!----
    　　<br><b><a href="#NG-VIP">VIPだけ、nslookup NG</a></b>
    　　<br><b><a href="#NG-TCP">nslookup NG(TCP問い合わせ)</a></b>
    　　<br><b><a href="#IPv6-NG">IPv6のnslookup NG</a></b></td>
----->
    <td><font color="blue">Subject:  サーバ名 nslookup NG</font><br>
        監視WSから対象DNSサーバへnslookupを行い、レスポンスが遅いときや応答が無いときに出ます<br>
    <font color="red">※この警報が出るとDNSサービス赤信号（サービスへの影響が出ています）<br>
    <font color="red">※サービス確認がOKでも、3～4回警報が出続ける場合は、<a href="#restart"><u><font color="#0066bb">プロセス再起動</font></u></a>してください。</font></td>
    <td>　</td>
  </tr>

    <tr>
    <td>４</td>
    <td><b><a href="#recursive"><u><font color="#0066bb">RECURSIVE-CLIENTS ALARM!</font></u></a></td>
    <td><font color="blue">Subject:  RECURSIVE-CLIENTS ALARM! ns6-tk01</font><br>
        recursive clientsのセッション数が規定値を超えると出ます。（規定値はそれぞれのサーバで異なります）<br>
    <font color="red">※この警報が出るとDNSサービス赤信号（サービスへの影響が出ています）</font></td>
    <td>BIND(named動作機のみ)</td>
  </tr>

    <tr>
    <td>５</td>
    <td><b><a href="#memory"><u><font color="#0066bb">Memory over!!</font></u></a></td>
    <td><font color="blue">Subject:  [DNS]サーバ名 Memory over !</font><br>
        Memoryの使用率が規定値を超えると出ます。（規定値はそれぞれのサーバで異なります）<br>
    <font color="red">※サービス確認がOKでも2～3回警報が出続ける場合は、<a href="http://XXXXXXX"><u><font color="#0066bb">エスカレーション</font></u></a>し<a href="#restart"><u><font color="#0066bb">プロセス再起動</font></u></a>の判断を仰いで下さい</font></td>
        </td>
    <td>　</td>
  </tr>
  
    <Table Border="0"><tr><Td ColSpan="4"><b>　※LinuxサーバのH/W故障時に出る警報一覧は<a href="./linux/XXXXX.html">こちら</a></b></Td></tr></Table>

</Table>



<a name="#service">
<font size="6"><b>★サービス確認</b></font>
作業WSから該当サーバに対してdig(名前解決)を行ってください。
※サーバを指定する際は<a href="http://XXXX.html"><u><font color="#0066bb">サーバ一覧表</font></u></a>のホスト名欄に<font color="red">「公開名」と記載のあるホスト名を指定しないと名前解決出来ない為ご注意ください</font>

<Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>
<font size="2">[accountXX@server ~]$<font color="red"> dig @サーバ www.ocn.ad.jp <b>←★@の後は警報が出たサーバの公開名を指定する（重要）</b></font>
; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.68.rc1.el6_10.1 <<>> @サーバ www.ocn.ad.jp
; (2 servers found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, <font color="red">status: NOERROR,</font> id: 45778
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;www.ocn.ad.jp.                 IN      A

<font color="red">;; ANSWER SECTION:
www.ocn.ad.jp.          600     IN      A       0.0.0.0</font>

;; Query time: 19 msec
;; SERVER: XXXXXXX#53(XXXXXXX)
;; WHEN: Thu Feb 13 17:56:47 2020
;; MSG SIZE  rcvd: 47

<font color="red"><b>■statusがNOERRORであり、ANSWER SECTIONにレコードが返ってくることを確認　(値が異なって返ってくることがあるかもしれませんが何かしら返ってくればOKです)</b></font>



<b>▼上記と同じ作業を別ドメインでも返ってくるか確認する</b>
<font size="2">[accountXX@server ~]$ dig @サーバ <font color="red"><b>www.yahoo.co.jp ←★@の後は警報が出たサーバの公開名を指定する（重要）</b></font>

; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.68.rc1.el6_10.1 <<>> @サーバ www.yahoo.co.jp
; (2 servers found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, <font color="red">status: NOERROR,</font> id: 45476
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;www.yahoo.co.jp.               IN      A

<font color="red">;; ANSWER SECTION:
www.yahoo.co.jp.        900     IN      CNAME   XXXXX.jp.
XXXXXXXXXX.       60      IN      A       0.0.0.0</font>

;; Query time: 20 msec
;; SERVER: XXXXX#53(XXXXX)
;; WHEN: Thu Feb 13 18:00:14 2020
;; MSG SIZE  rcvd: 77



<font color="green">※cacheserveが起動しているサーバ(サーバ一覧の起動プロセス項目にcacheserveと記載があるもの)については以下のコマンドも実施してください。</font>
サーバ一覧は：<a href="http://XXXXXX.html"><u><font color="#0066bb">こちら</font></u></a></font>
<font size="2">$ <font color="red">dig @サーバ名 www.ocn.ne.jp aaaa </font>

; <<>> DiG 9.11.4-P2-RedHat-9.11.4-9.P2.el7 <<>> @サーバ名 www.ocn.ne.jp aaaa
; (2 servers found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 7112
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;www.ocn.ne.jp.                 IN      AAAA

;; ANSWER SECTION:
www.ocn.ne.jp.          396     IN      AAAA    XXXXX　←<font color="red">★ANSWERがかえってくることを確認。
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　ただしサーバ一覧の起動プロセス項目に
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　AAAA-Filterと記載のあるサーバについては
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　status: NOERRORでANSWERがないことを確認してください。</font>
;; Query time: 2 msec
;; SERVER: XXXX#53(XXXX)
;; WHEN: 金  2月 14 13:44:42 JST 2020
;; MSG SIZE  rcvd: 70



<font color="red"><b>■statusがNOERRORであり、ANSWER SECTIONにレコードが返ってくることを確認　(値が異なって返ってくることがあるかもしれませんが何かしら返ってくればOKです)</b>
<b>※statusがREFUSEDで返ってきた場合[recursion no]設定サーバであれば問題ございませんので以下の確認をお願いします。</b></font>
<a name="recursion_no"></a>
<font color=blue>
<b>[recursion no]設定サーバは、他サーバへ再起的な問い合わせを行いません。
そのため、以下のようにstatusがREFUSEDで返ってくる場合がありますが、これで確認OKです
<a href="http://XXXX.html"><u><font color="#0066bb">サーバ一覧表</font></u></a>の運用状況欄に「<font color="red">recursion no</font>」の記載があるサーバが該当します。</b>

[account@server ~]$ dig @サーバ名 www.yahoo.co.jp

; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.68.rc1.el6_10.1 <<>> @サーバ名 www.yahoo.co.jp
; (2 servers found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, <font color="red">status: REFUSED,</font> id: 13249
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 0
;; WARNING: recursion requested but not available

;; QUESTION SECTION:
;www.yahoo.co.jp.               IN      A

;; Query time: 4 msec
;; SERVER: XXXX#53(XXXXX)
;; WHEN: Thu Feb 13 18:02:10 2020
;; MSG SIZE  rcvd: 33


</font>
</Pre></Td></Tr>
</Table>


<a name="#top">
<font size="6"><b>★リソース確認</b></font>
作業WSから該当サーバにログインしてtopコマンドを実行してください。（以下実行例）

・CPU OVER! の場合 →  <font color="red">%CPU（赤）</font>
・Memory OVER! の場合 → <font color="green">%MEM（緑）</font>       の箇所を確認すること

<Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>
<font size="2">pisces $ <font color="red">ssh accountXX@サーバ名 </font>
[accountXX@server ~]$ <font color="red" size="3">top </font>  <br><br>
【出力例】
top - 10:59:17 up 2072 days, 18:56,  1 user,  load average: 0.05, 0.02, 0.00
Tasks: 418 total,   1 running, 417 sleeping,   0 stopped,   0 zombie
Cpu(s):  0.7%us,  0.5%sy,  0.0%ni, 98.8%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Mem:  32838736k total,  3349248k used, 29489488k free,   838832k buffers
Swap: 16777208k total,        0k used, 16777208k free,   973732k cached

  PID USER      PR  NI  VIRT  RES  SHR S <font color="red">%CPU</font> <font color="green">%MEM</font>    TIME+  COMMAND
45285 named     20   0 1338m 801m 2828 S <font color="red">26.6</font>  <font color="green">2.5</font>  56547:13 named      ←★namedのリソース状態を見る
65196 accountc6  20   0 15288 1580  996 R  0.3  0.0   0:00.13 top
    1 root      20   0 19348 1612 1308 S  0.0  0.0  14:25.20 init
    2 root      20   0     0    0    0 S  0.0  0.0   0:00.00 kthreadd
    3 root      RT   0     0    0    0 S  0.0  0.0   0:02.63 migration/0
    4 root      20   0     0    0    0 S  0.0  0.0  81:29.67 ksoftirqd/0
    5 root      RT   0     0    0    0 S  0.0  0.0   0:00.01 migration/0
    
    ～～～～～～～～～～～～～～～～(省略)～～～～～～～～～～～～～～～～～～</font></Pre></Td></Tr>

</Table>


<a name="#process">
<font size="6"><b>★プロセス確認</b></font>
    <font color="blue">以下のコマンドで、プロセスが起動している事を確認</font>
<Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>

# <font color="red">ps -ef | grep -e named -e cacheserve | grep -v account | grep -v grep</font>
named    21769     1  0 Jan23 ?        00:00:06 <font color="red">/usr/sbin/named</font> -u named -c /etc/named.conf
　　※BINDサーバです。
<!------------
# <font color="red">/home/sh/querywatch.sh 5 </font>
------------->

# <font color="red">ps -ef | grep -e named -e cacheserve | grep -v grep</font>
root      2121     1  0  2018 ?        00:00:04 /usr/local/nom/sbin/cacheserve --syslog-facility local5
root      2122  2121  4  2018 ?        35-22:00:30 /usr/local/nom/sbin/cacheserve --syslog-facility local5
root      2174     1  1  2018 ?        10-15:43:23 cacheserve-statmon: running
　　※cacheserveサーバです。


<font size="3">プロセス再起動手順は<b><a href="#restart"><u><font color="#0066bb">こちら</font></u></b></a></font>

</font></pre></Td></Tr>

    </Table>

    <font size="3">
        <b>【各種MRTGへのリンク】</b>
        <UL>
            <LI><b>DNS CPU使用率</b></LI>
            [Linux_BIND]
            <a href="http://XXXXX.html" target="huga"><u><font color="#0066bb">http://XXXXX.html</font></u></a>
            [Linux_Cacheserve]
            <a href="http://XXXXX.html" target="huga"><u><font color="#0066bb">http://XXXXX.html</font></u></a>

            <LI><b>DNS Memory使用率</b></LI>
            [Linux_BIND]
            <a href="http://XXXXX.html" target="huga"><u><font color="#0066bb">http://XXXXX.html</font></u></a>
            [Linux_Cacheserve]
            <a href="http://XXXXX.html" target="huga"><u><font color="#0066bb">http://XXXXX.html</font></u></a>

            <LI><b>DNS query数</b></LI>
            [Linux_BIND]
            <a href="http://XXXXX.html" target="huga"><u><font color="#0066bb">http://XXXXX.html</font></u></a>
            [Linux_Cacheserve]
            <a href="http://XXXXX.html" target="huga"><u><font color="#0066bb">http://XXXXX.html</font></u></a>


        </UL>
    </font>
    <!-------------------------------------------------------------------------------------------------------------------->
    <hr>
    <font size="4"><b>【警報対処方法】</b></font>
    <a name="cpu"></a>
    <Table Width="100%">
        <Tr BGCOLOR="#006400" Align="left">
            <Th><font color="white">１．CPU ??% OVERが出たら</font></Th>

        </Tr>
    </Table>

    <font size="4" color="red">※サービス確認がOKでも2～3回警報が出続ける場合は、<a href="http://XXXXX"><u><font color="#0066bb">エスカレーション</font></u></a>し<a href="#restart"><u><font color="#0066bb">プロセス再起動</font></u></a>の判断を仰いで下さい</font>


    <b>(1)サービス確認</b>

    <b><a href="#service"><u><font color="#0066bb">サービス確認</font></u></a></b>を実施
    確認した結果、「レスポンスが遅い」または「同じサーバからの警報が頻発する」場合。次項（2）に進む


    <!---
    <Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>
    これでもOK

    <font size="2"><b>【CPU ??% OVER 警報時のサービス確認ツール】</b>
    警報発生時にtaurus上でそのまま一次確認ができるスクリプトです。
    該当サーバに対してdig応答時間、dig結果、top結果が確認できます。

    taurusで実行
    ex.) # /home/sh/top_query.pl server
    <a href="http://XXXXX.txt">使用方法、実行結果はこちら</a>
    </font></Pre></Td></Tr>
    </Table>
    -->
    <!-------------------->
    <b>(2)該当サーバのCPU使用値の確認</b>

    a) 該当サーバにログインし　topコマンド（確認方法は<b><a href="#top"><u><font color="#0066bb">こちら</font></u></a></b>を実施）を実施
    b) 確認した結果、CPU値が下がらない場合、次項（3）に進む



    <!-------------------->
    <b>(3)CPU値が下がらない場合</b>

    a) <b><a href="#process"><u><font color="#0066bb">プロセス確認</font></u></a></b>で起動サービスを確認。
    b) ・<font color="red"><b>LinuxのBINDサーバ</b></font>：<font size="3" color="red"><b> named</b></font>のリスタートを行う → リスタート手順は <b><a href="#restart"><u><font color="#0066bb">こちら</font></u></a></b>
    ※それでもCPUが下がらない場合はc)のソースIP特定に進む
    ・<font color="red"><b>cacheserve起動サーバ</b></font>:c)のソースIP特定へ
    <font size="2">
        ※<font color="blue">ルータ輪番へnamed restartした旨の連絡</font>をする（ルータ輪番のログチェック作業にhealth check NGが現れる為）
        -----------------------------------------------
        ルータ輪番さま
        本日下記の時間にnamedの再起動を行いました
        SI,またはAXのHealth Check NGが発生している場合があります
        server : 2017/03/31 15:00
        -----------------------------------------------
    </font>


    c) <b>ソースIP特定</b>を行う
    <b>[<a href="#sourceIP"><u><font color="#0066bb">ソースIPを特定する</font></u></a>]</b>


    d) 現在のサービスの状況及び上記(a)～(c)の結果を確認したエスカレーションを行ってください。
    <b>[<a href="#escharation"><u><font color="#0066bb">エスカレーション</font></u></a>の実施]</b>
    <!-------------------
       大量queryを送信しているソースIPが存在する可能性があります。ソースIP特定を行ってください。
       nslookup遅延警報が併発したり、CPUが95％以上で張り付いた場合、そのソースIPのアクセス制限を行ってください。
       アクセス制限を行った後は、お客様対応をしてください。（下記リンク先の手順を参照する）

    <Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>
    <font size="2"><b>【ソースIP特定＆アクセス制限方法】</b>
     <b>[<a href="http://XXXXX.html">HP-UX</a>の場合]</b>
    <a href="http://XXXXX.html">http://XXXXX.html</a>
     <b>[<a href="http://aXXXXX.html">Linux</a> BINDの場合]</b>
    <a href="./linux/tokutei.html">http://XXXXX.html</a>　　　　　<a href="http://XXXXX.html">※PNSは詳細版(Top50)もあり</a>
     <b>[<a href="http://XXXXXr.html">Linux</a> vantioの場合]</b>
    <a href="./linux/vantio_tokutei.html">http://XXXXX.html</a>
    </font></Pre></Td></Tr>
    </Table>
    --------------------->
    <!-------------------------------------------------------------------------------------------------------------------->
    <hr color="lightblue">
    <a name="query"></a>
    <Table Width="100%">
        <Tr BGCOLOR="#006400" Align="left">
            <Th><font color="white">２．Query over! が出たら</font></Th>
        </Tr>
    </Table>
    <b>【調査内容】</b>
    Ⅰ．サーバ情報
    Ⅱ．サーバリソース確認
    a)サービス確認
    b)CPU使用率＆プロセス起動確認
    c)ソースIP調査

    <b>【調査手順】</b>
    <b>Ⅰ．サーバ情報</b>
    <font color="red">ZONE管理サーバ</font>
    a) サーバ一覧&で該当サーバ用途・プライマリ/セカンダリを確認してください。
    サーバ一覧:<a href="http://XXXXX.html"><u><font color="#0066bb">こちら(用途の項目確認)</font></u></a>
    b)プライマリ/セカンダリそれぞれのクエリ数の推移を確認してください。
    調査方法：<a href="http://XXXXX.html"><u><font color="#0066bb">こちら</font></u></a>
    注意：ユーザ用セカンダリサーバのプライマリサーバは、お客様が管理を行っております。

    <font color="red">負荷分散(cache)サーバ</font>
    a) サーバ一覧&VIP一覧で該当サーバ用途・Setを確認してください。
    サーバ一覧:<a href="http://XXXXXXXXXX.html"><u><font color="#0066bb">こちら(用途の項目確認)</font></u></a>　　　　VIP一覧:<a href="http://XXXXX.htm"><u><font color="#0066bb">こちら(一番左端の項目：Set確認/負荷分散DNS(内部名)の項目：同一Setサーバ確認)</font></u></a>
    b)同一Set他サーバの状況を確認してください。(東日本・西日本で冗長構成になっております。)
    調査方法：<a href="http://XXXXX.html"><u><font color="#0066bb">こちら</font></u></a>
    確認ポイント：東西両Setでクエリ数が増えているか？　片系の現象か？　単一サーバの現象か？


    <b>Ⅱ．サーバリソース確認</b>
    a) サービス確認
    <b><a href="#service"><u><font color="#0066bb">サービス確認</font></u></a></b>を実施

    b) CPU使用率&プロセス起動を確認してください。
    <Table Width="90%" align="center" Border cellpadding="5">
        <Tr>
            <Td>
                <Pre>
<font size="2">
該当サーバにログイン後
[CPU使用率確認]
# <font color="red">top </font> → 確認方法は<b><a href="#top"><u><font color="#0066bb">こちら</font></u></a></b>
 
[プロセス確認]
  以下のリンクの[プロセス確認]のみを実施してください。
  → プロセス確認手順は<b><a href="#process"><u><font color="#0066bb">こちら</font></u></a></b>
<!------------
# <font color="red">/opt/SHELL/cacheserve_querywatch.sh 5 </font>
------------->

</fo</Pre>
            </Td>
        </Tr>
    </Table>

    <a name="sourceIP"></a>
    c)ソースIP調査を確認してください。
    <Table Width="90%" align="center" Border cellpadding="5">
        <Tr>
            <Td>
                <Pre>
<font size="2">
該当サーバにログイン後
[ソースIP調査]

# <font color="red">/home/sh/querywatch.sh 5
##### named is running in this server. #####
================================================================
Mon Feb 17 11:55:13 JST 2020 ( logging 5 sec. )
server's Heavy Query Source List
================================================================
30      0.0.0.0
34      0.0.0.0 
38      0.0.0.0 3(NXDOMAIN)
46      0.0.0.0 2(SERVFAIL)
47      0.0.0.0 2(SERVFAIL)
48      0.0.0.0 3(NXDOMAIN)
60      0.0.0.0 
93      0.0.0.0 3(NXDOMAIN)
140     0.0.0.0 3(NXDOMAIN)
298     0.0.0.0 3(NXDOMAIN)
================================================================
Please Check [OFF] : query logging is OFF

<font color="red">※出力例について、左から「クエリ数/ソースIP/ソースIPを逆引きで引いた結果」となります。</font>
</fo</Pre>
            </Td>
        </Tr>
    </Table>

    <a name="#escharation">
        <b>(2)エスカレーション</b>
        nslookup NG 警報が併発したり、CPUが95％以上で張り付いたり、問題事象が継続している。
        <b>[<a href="http://XXXX.html#query"><u><font color="#0066bb">【調査内容】</font></u></a>を把握した上で、エスカレーションを実施してください。</b>　　→エスカレ先は<a href="http://XXXX"><u><font color="#0066bb">こちら</font></u></a>

        <b>　　(a)ユーザ対応の指示あり</b>
        下記リンク先、<font color="red">”お客様対応”</font>手順を実施お願い致します
        <Table Width="90%" align="center" Border cellpadding="5">
            <Tr>
                <Td>
                    <Pre>
<font size="2"><b>【ユーザ対応方法】</b>
                    <b>[<a href="http://XXXX.html">Linux</a> BINDの場合]</b>
                    <a href="./linux/tokutei.html">http://XXXX.html</a>　　　　　<a href="http://XXXX.html">※PNSは詳細版(Top50)もあり</a>
                    <b>[<a href="http://XXXX.html">Linux</a> cacheserveの場合]</b>
                    <a href="./linux/cacheserve_tokutei.html">http://XXXX.html</a>
</font></Pre>
                </Td>
            </Tr>
        </Table>

        <b>　　(b)アクセス制限の指示あり</b>
        下記リンク先、<font color="red">”アクセス制限(blackhole設定)＆お客様対応”</font>手順を実施お願い致します
        <Table Width="90%" align="center" Border cellpadding="5">
            <Tr>
                <Td>
                    <Pre>
<font size="2"><b>【アクセス制限方法】</b>
                    <b>[<a href="http://XXXX.html">Linux</a> BINDの場合]</b>
                    <a href="./linux/XXXX.html">http://aXXXX.html</a>　　　　　<a href="http://XXXX.html">※PNSは詳細版(Top50)もあり</a>
                    <b>[<a href="http://XXXX.html">Linux</a> cacheserveの場合]</b>
                    <a href="./linux/cacheserve_tokutei.html">http://XXXX.html</a>
</font></Pre>
                </Td>
            </Tr>
        </Table>

        <!-------------------------------------------------------------------------------------------------------------------->
        <hr color="lightblue">
        <a name="NG"></a>
        <Table Width="100%">
            <Tr BGCOLOR="#006400" Align="left">
                <Th><font color="white">３．nslookup NGが出たら</font></Th>
            </Tr>
        </Table>

        <font size="4"><b>■DNS名前解決NGの警報種類</b></font>
        <font size="4" color="red"><b>※サービス確認がOKでも、3～4回警報が出続ける場合は、<a href="#process"><u><font color="#0066bb">プロセスを確認</font></u></a>の上<a href="#restart"><u><font color="#0066bb">再起動</font></u></a>してください。</b></font>
        <!---
        <font size="4" color="red"><b>※　警報タイトルと、下記項目の”警報Subject”を比較してください。</b></font>
        ---->
        <Table align="center" border>
            <tr bgcolor="9600C8">
                <td><font color="white">種類</font></td>
                <td><font color="white">警報Subject</font></td>

                <td><font color="white">警報メールのSubject概要</font></td>
                <td><font color="red">輪番者対応手順</font></td>
                <td><font color="white">サービス確認作業</font></td>
            </tr>

            <tr>
                <td>１</td>
                <td><b>[DNS_UDP_IPv4]</b></td>
                <td>
                    <font color="blue">Subject:[DNS_UDP_IPv4]server nslookup NG</font><br>
                    IPv4アドレスでUDPの名前解決不可に出ます
                </td>
                <td><a href="#NG-def"><u><font color="#0066bb">3-0</font></u></a>＋<a href="#NG-VIP"><u><font color="#0066bb">3-1</font></u></a>
    </a></td>
    <td>serverで、サービス確認実施</td>
    </tr>

    <tr>
        <td>２</td>
        <td><b>[DNS_TCP_IPv4]</b></td>
        <td>
            <font color="blue">Subject:[DNS_TCP_IPv4]server nslookup NG</font><br>
            IPv4アドレスでTCPの名前解決不可に出ます
        </td>
        <td><a href="#NG-TCP"><u><font color="#0066bb">3-2</font></u></a></td>
        <td>serverで、サービス確認実施</td>
    </tr>

    <tr>
        <td>３</td>
        <td><b>[DNS_UDP_IPv6]</b>
        <td>
            <font color="blue">Subject:[DNS_UDP_IPv6]server nslookup NG</font><br>
            IPv6アドレスでUDPの名前解決不可に出ます
        </td>
        <td><a href="#IPv6-NG"><u><font color="#0066bb">3-3</font></u></a></td>
        <td>serverで、サービス確認実施</td>
    </tr>

    <tr>
        <td>４</td>
        <td><b>[DNS_TCP_IPv6]</td>
        <td>
            <font color="blue">Subject:[DNS_TCP_IPv6]server nslookup NG</font><br>
            IPv6アドレスでTCPの名前解決不可に出ます
        </td>
        <td><a href="#IPv6-NG"><u><font color="#0066bb">3-3</font></u></a></td>
        <td>serverで、サービス確認実施</td>
    </tr>

    <tr>
        <td>５</td>
        <td><b>[DNS_UDP]</b></td>
        <td>
            <font color="blue">Subject:[DNS_UDP]server nslookup NG</font><br>
            IPv4アドレスでUDPの名前解決不可に出ます
        </td>
        <td><a href="#NG-def"><u><font color="#0066bb">3-0</font></u></a>＋<a href="#NG-VIP"><u><font color="#0066bb">3-1</font></u></a></a></td>
        <td>serverで、サービス確認実施</td>
    </tr>

    <tr>
        <td>６</td>
        <td><b>[DNS_TCP]</b></td>
        <td>
            <font color="blue">Subject:[DNS_TCP]server nslookup NG</font><br>
            IPv4アドレスでTCPの名前解決不可に出ます
        </td>
        <td><a href="#NG-TCP"><u><font color="#0066bb">3-2</font></u></a></td>
        <td>serverで、サービス確認実施</td>
    </tr>

    <tr>
        <td>７</td>
        <td><b>[DNS_UDP_IPv6_IPoE]</b></td>
        <td>
            <font color="blue">Subject:[DNS_UDP_IPv6_IPoE]server nslookup NG</font><br>
            IPv6アドレスでUDPの名前解決不可に出ます
        </td>
        <td><a href="#NG-VIP-IPoE"><u><font color="#0066bb">3-5</font></u></a></td>
        <td>ユーザ影響があるためエスカレーションをお願いいたします</td>
    </tr>

    <tr>
        <td>８</td>
        <td><b>[DNS_TCP_IPv6_IPoE]</b></td>
        <td>
            <font color="blue">Subject:[DNS_TCP_IPv6_IPoE]server nslookup NG</font><br>
            IPv6アドレスでTCPの名前解決不可に出ます
        </td>
        <td><a href="#NG-VIP-IPoE"><u><font color="#0066bb">3-5</font></u></a></td>
        <td>ユーザ影響があるためエスカレーションをお願いいたします</td>
    </tr>

    </Table>

    <hr color="lightblue">
    <a name="NG-def"></a>
    <Table Width="100%">
        <Tr BGCOLOR="#006400" Align="left">
            <Th><font color="white">3-0．nslookup NGが出たら </font></Th>
        </Tr>
    </Table>

    <b>(1)サービス確認</b>>
    ※IPv4-UDP調査方法です

    a) <b><a href="#service"><u><font color="#0066bb">サービス確認</font></u></a></b>を実施
    確認した結果、「レスポンスが遅い」または「同じサーバからの警報が頻発する」場合。次項（2）に進む

    <!-------------------->
    <b>(2)該当サーバのCPU使用値の確認</b>

    a) 該当サーバにログインし　topコマンド（確認方法は<b><a href="#top"><u><font color="#0066bb">こちら</font></u></a></b>を実施）を実施
    －確認した結果、CPU値が下がらない場合は<a href="#cpunodown"><u><font color="#0066bb">(3-1)</font></u></a>に進む
    Memory値が下がらない場合は<a href="#memory95%over"><u><font color="#0066bb">(3-2)</font></u></a>に進む


    b) BINDのスタックが疑われる場合は、
    # kill -9 [PID]　行った後に、namedプロセス起動(プロセス起動方法　リスタート方法は<a href="#restart"><u><font color="#0066bb">こちら</font></u></a>)
    －BINDのスタック判断は、以下の2つを判断材料としてください。
    # ps -ef | grep named | grep -v grep　 ：　プロセス確認できるが、サービス確認は、nslookup NG
    # top                　 ：　確認した結果、namedプロセスCPU使用率が、0%　又は、低い

    <font color="red">【注意１】BINDのスタック中は、querywatch.sh実施しないでください。</font>
    →実施した方は、別ターミナル起動してquerywatch.shプロセスをkillしてください。
    BIND起動後に、クエリOFFであることを確認してください
    # rndc status     ←ONの場合は、<a href="http://server.html"><u><font color="#0066bb">対応手順こちら</font></u></a>

    <font color="red">
        【注意２】namedが起動していない場合、cronで自動起動します。もしプロセス起動確認時に2重起動している場合は、
        1つだけ起動させるようにしてください。
    </font>
    <a name="cpunodown">

        <b>(3－1)CPU値が下がらない場合　ソースIP特定を行う</b>
        <b>[<a href="#sourceIP"><u><font color="#0066bb">ソースIP特定手順へ</font></u></a>]</b>
        → 特定後、<a href="#escharation"><u><font color="#0066bb">エスカレーション</font></u></a>へ
        <!-------------------
          大量queryを送信しているソースIPが存在する可能性があります
          ソースIP特定を行ってください
          nslookup遅延警報が併発したり、CPUが95％以上で張り付いた場合、そのソースIPのアクセス制限を行ってください。

        <Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>
        <font size="2"><b>【ソースIP特定＆アクセス制限方法】</b>
         <b>[<a href="http://XXXX.html">HP-UX</a>の場合]</b>
        <a href="http://XXXX.html">http://XXXX.html</a>
         <b>[<a href="http://XXXX.html">Linux</a> BINDの場合]</b>
        <a href="./linux/tokutei.html">http://XXXX.html</a>　　　　　<a href="http://XXXX.html">※PNSは詳細版(Top50)もあり</a>
         <b>[<a href="http://XXXX.html">Linux</a> vantioの場合]</b>
        <a href="./linux/vantio_tokutei.html">http://XXXX.html</a>
        </font></Pre></Td></Tr>
        </Table>
        --------------------->
        <a name="memory95%over">

            <b>(3－2)メモリ使用率が95％以上の場合　named（もしくはcacheserve)のrestartを行う</b>
        </a>
        named（もしくはcacheserve）の再起動を行い、メモリを開放してください　　→　リスタート手順は<b><a href="#restart"><u><font color="#0066bb">こちら</font></u></a></b>
        ※日勤帯はDNS担当へ連絡ください
        夜間帯実施する場合は、SOが動作しているAM0:00～0:30頃を避けて実施してください。
        <font size="2">
            ※<font color="blue">ルータ輪番へnamed restartした旨の連絡</font>をする（ルータ輪番のログチェック作業にhealth check NGが現れる為）
            -----------------------------------------------
            ルータ輪番さま
            本日下記の時間にnamedの再起動を行いました
            ThunderかAXよりHealth Check NGが発生している場合があります
            server : 2017/03/31 15:00
            -----------------------------------------------
        </font>


        <!-------------------------------------------------------------------------------------------------------------------->
        <hr color="lightblue">
        <a name="NG-VIP"></a>
        <Table Width="100%">
            <Tr BGCOLOR="#006400" Align="left">
                <Th><font color="white">3-1．VIPだけnslookup NGが出たら</font></Th>
            </Tr>
        </Table>

        <font size="5" color="red"><b>VIP名前解決NGが継続している場合サービス影響でています。</b></font>

        ・至急エスカレーションの実施（各センタへの連絡、techweb掲載判断）

        ・ルータ輪番と協力して被疑ヶ所の探索実施
        VIPのみ名前解決NG場合、上位NWに問題がある可能性があります。

        ・故障対応（必要に応じてルータ班マネージャへのエスカレーション）


        <!-------------------------------------------------------------------------------------------------------------------->
        <hr color="lightblue">
        <a name="NG-TCP"></a>
        <Table Width="100%">
            <Tr BGCOLOR="#006400" Align="left">
                <Th><font color="white">3-2．[DNS_TCP]　nslookup NGが出たら</font></Th>
            </Tr>
        </Table>

        <font size="5" color="red"><b>[DNS_TCP_IPv?]nslookup NG警報のみ発生した場合の調査方法</b></font>

        <font size="3">UDPのnslookup NG警報発生している場合は、<b><a href="#NG">nslookup NG</a></b>へ　　UDP調査を実施ください</font>

        <b>(1)サービス確認</b>

        a) <b>作業WS[server]から</b>該当サーバに対して以下のdigを行ってください。
        確認した結果、「レスポンスが遅い」または「同じサーバからの警報が頻発する」場合。次項（2）に進む

        <Table Width="90%" align="center" Border cellpadding="5">
            <Tr>
                <Td>
                    <Pre>
<font size="2">[accountXX@server ~]$ <font color="red">dig @サーバ 1000.sub.16mhz.net TXT +noall +co +stat <b>←★@の後は警報が出たサーバの公開名を指定する（重要）</b></font>

<font color="red">;; Truncated, retrying in TCP mode.</font>

; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.68.rc1.el6_10.1 <<>> @サーバ 1000.sub.16mhz.net TXT +noall +co +stat
; (2 servers found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY,status: <font color="red">NOERROR,</font> id: 1984
;; flags: qr rd ra; QUERY: 1, ANSWER: 16, AUTHORITY: 0, ADDITIONAL: 0

;; Query time: 3 msec
;; SERVER: XXXXXXXX#53(XXXXXXXX)
;; WHEN: Mon Feb 17 10:21:40 2020
;; MSG SIZE  <font color="red">rcvd: 961</font>

<font color="red"><b>■TCPにフォールバックされstatusがNOERRORであり、MSG SIZEが961バイトのサイズが返ってくることを確認</b>
<b>※statusがREFUSEDで返ってきた場合[recursion no]設定サーバであれば問題ございませんので以下の確認をお願いします。</b></font>

<a name="recursion_no"></a>
<font color=blue>
<b>[recursion no]設定サーバは、他サーバへ再起的な問い合わせを行いません。
そのため、以下のようにstatusがREFUSEDで返ってくる場合がありますが、これで確認OKです
<a href="http://XXXXXXXX.html"><u><font color="#0066bb">サーバ一覧表</font></u></a>の運用状況欄に「recursion no」の記載があるサーバが該当します。</b>

[account00@server ~]$ dig @server 1000.sub.16mhz.net TXT +noall +co +stat

; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.68.rc1.el6_10.1 <<>> @server 1000.sub.16mhz.net TXT +noall +co +stat
; (2 servers found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY,<font color="red">status: REFUSED,</font> id: 6138
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 0
;; WARNING: recursion requested but not available

;; Query time: 12 msec
;; SERVER: XXXXXXXX#53(XXXXXXXX)
;; WHEN: Mon Feb 17 10:25:11 2020
;; MSG SIZE  rcvd: 36</font></Pre>
                </Td>
            </Tr>
        </Table>
        <!-------------------->
        <b>(2)名前解決(dig)のレスポンスが遅い もしくは 警報が頻発する場合、プロセスリスタート実施</b>
        a)<a href="#process"><u><font color="#0066bb">プロセスを確認</font></u></a>の上<a href="#restart"><u><font color="#0066bb">再起動</font></u></a></font></u>
    </a></b>を実施してください。
    b)金沢SOセンタ連絡
    ----
    ・警報発生、名前解決NGだった場合
    フロントへの連絡（仙台常時・日勤であれば常時カスタマも併せて）お願いします。

    ・影響の伝え方としては、
    「該当時間帯にTCPで名前解決をしようとした際に
    不安定になっていた可能性があります」位でよいです。
    ※[DNS_TCP]で警報が出た場合、通常のUDPで
    名前解決使用した場合は影響がないはずです。

    ・一応、故障DBも起票・記入して下さい。
    ----



    <hr color="lightblue">
    <a name="IPv6-NG"></a>
    <Table Width="100%">
        <Tr BGCOLOR="#006400" Align="left">
            <Th><font color="white">3-3．IPv6だけnslookup NGが出たら</font></Th>
        </Tr>
    </Table>

    <font size="3">IPv4のnslookup NG警報発生している場合は、<b><a href="#NG"><u><font color="#0066bb">nslookup NG</font></u></a></b>へ　　IPv4調査を実施ください</font>

    サービス確認は下記手順に従ってください。
    <font size="4" color="red"><b>※サービス確認がOKでも、3～4回警報が出続ける場合は、<a href="#process"><u><font color="#0066bb">プロセスを確認</font></u></a>の上<a href="#restart"><u><font color="#0066bb">再起動</font></u></a></font></u></a></b>を実施してください。

    ■作業WS
    server

    ■アカウント
    account00

    ■ツールのありか
    /home/XXXXXXXX/XXXXXXXX/dig-check.sh

    ■スクリプト
    dig-check.sh　”警報が上がっているホスト名”

    ■使用例：もし server で警報が上がった場合
    例）
    [account00@server ~]$ ./dig-check.sh server
    ====
    server is IPv4-and-IPv6
    ====
    ++++++++++++++++++++++++++++++++++
    server is server  IPv4-add XXXXXXXX [UDP] localhost　　　　　　★★　IPv4のUDP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ---
    server is server  IPv4-add XXXXXXXX [UDP] yahoo.co.jp　　　　　★★　IPv4のUDP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ---
    server is server  IPv4-add XXXXXXXX [UDP] google.co.jp　　　　 ★★　IPv4のUDP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ++++++++++++++++++++++++++++++++++
    server is server  IPv4-add XXXXXXXX [TCP] localhost　　　　　　★★　IPv4のTCP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ---
    server is server  IPv4-add XXXXXXXX [TCP] yahoo.co.jp　　　　　★★　IPv4のTCP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ---
    server is server  IPv4-add XXXXXXXX [TCP] google.co.jp　　　　 ★★　IPv4のTCP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ++++++++++++++++++++++++++++++++++
    server is server  IPv6-add XXXXXXXX [UDP] localhost　　 ★★　IPv6のUDP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ---
    server is server  IPv6-add XXXXXXXX [UDP] yahoo.co.jp　 ★★　IPv6のUDP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ---
    server is server  IPv6-add XXXXXXXX [UDP] google.co.jp　★★　IPv6のUDP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ++++++++++++++++++++++++++++++++++
    server is server  IPv6-add XXXXXXXX [TCP] localhost　　 ★★　IPv6のTCP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ---
    server is server  IPv6-add XXXXXXXX [TCP] yahoo.co.jp　 ★★　IPv6のTCP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし
    ---
    server is server  IPv6-add XXXXXXXX [TCP] google.co.jp　★★　IPv6のTCP
    status: NOERROR,　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　★★　”status: NOERROR”問題なし


    ・IPv4アドレスの名前解決もNGである場合
    <a href="#NG-def">「nslookup NGが出たら」</a>の手順に従ってください。

    ・IPv6アドレスの名前解決のみNGが続いている。
    →1分以上経っても事象が改善されない。
    →<font color="red"><b>プロセスリスタート</b></font>
    プロセスリスタート行う。リンク先の対応手順を見ながら実施、<b><a href="#restart"><u><font color="#0066bb">参考手順</a></font></u></b>
    →センタ連絡
    ----
    ・警報発生、名前解決NGだった場合
    フロントへの連絡（仙台常時・日勤であれば常時カスタマも併せて）お願いします。

    ・影響の伝え方としては、
    「該当時間帯にIPv6で名前解決をしようとした際に
    不安定になっていた可能性があります」位でよいです。
    ※IPv6で警報が出た場合、通常のIPv4で
    名前解決使用した場合は影響がないはずです。

    ・一応、故障DBも起票・記入して下さい。
    ----

    プロセスリスタート後 1 分以上経っても改善しない場合はエスカレをお願いします

    <!-------------------------------------------------------------------------------------------------------------------->
    <hr color="lightblue">
    <a name="NG-VIP-IPoE"></a>
    <Table Width="100%">
        <Tr BGCOLOR="#006400" Align="left">
            <Th><font color="white">3-5．IPoE用VIPだけnslookup NGが出たら</font></Th>
        </Tr>
    </Table>

    <font size="5" color="red"><b>VIP名前解決NGが継続している場合サービス影響でています。</b></font>

    
    ・エスカレーションの実施（各センタへの連絡）

    ・ルータ輪番と協力して被疑ヶ所の探索実施
    VIPのみ名前解決NG場合、上位NWに問題がある可能性があります。

    ・故障対応（必要に応じてルータ班マネージャへのエスカレーション）

    <!-------------------------------------------------------------------------------------------------------------------->
    <hr color="lightblue">
    <a name="recursive"></a>
    <Table Width="100%">
        <Tr BGCOLOR="#006400" Align="left">
            <Th><font color="white">４．RECURSIVE-CLIENTS ALARM!が出たら</font></Th>
        </Tr>
    </Table>


    <b>(1)named再起動</b>

    a) 対象DNSサーバにログインし、<a href="#process"><u><font color="#0066bb">プロセスを確認</font></u></a>の上<a href="#restart"><u><font color="#0066bb">再起動</font></u></a></font></u></a></b>を実施してください。
    

    <b>(2)サービス確認</b>

    a) 対象サーバ向けに名前解決確認をし、レスポンスを確認してください。
    このとき、www.yahoo.co.jpなどOCNでは管理していないドメイン（リカージョンクエリ）の名前解決を行ってください。
    → サービス確認手順は <b><a href="#service"><u><font color="#0066bb">こちら</font></u></a></b>

    b) namedのログを確認し、「no more recursive clients: quota reached」というログがnamed再起動後に出ていないことを確認してください。
    OSによってnamedのログの場所が異なります。

    <Table Width="90%" align="center" Border cellpadding="5">
        <Tr>
            <Td>
                <Pre>
<font size="2"><b>【v6DNSログ確認方法】</b>
# <font color="red">grep "quota reached" /XXX/XXXXX/XXXXX/named.log </font>
	named再起動後に上記のログが出ていないこと

<b>【LinuxDNS(BIND)ログ確認方法】</b>
# <font color="red">grep "quota reached" /var/log/named.log </font>
	named再起動後に上記のログが出ていないこと</font>

<font size="3">「no more recursive clients: quota reached」というログが出続けている場合は、次(３)に進む</font></Pre>
            </Td>
        </Tr>
    </Table>

    <b>(3)ソースIP特定、アクセス制限</b>
    <b>[<a href="#query"><u><font color="#0066bb">Query Over！</font></u></a>の対応手順実施]</b>
    </pre>


    <a name="memory"></a><pre>
<Table Width="100%">
    <Tr BGCOLOR="#006400" Align="left">
    <Th><font color="white">５．Memory overが出たら</font></Th>
    </Tr>
</Table>
<font size="4"><font color="red">※linuxサーバのうち、linuxサーバ一覧の起動プロセス項目に(停止中)と
  記載のあるサーバは意図的にプロセスを停止していますのでMemory OVERの対応は必要ありません。</font>
　linuxサーバ一覧は：<a href="http://XXXXX.html"><u><font color="#0066bb">こちら</font></u></a></font>

<font size="4" color="red"><b>※サービス確認がOKでも2～3回警報が出続ける場合は、<a href="http://XXXXX"><u><font color="#0066bb">エスカレーション</font></u></a>し<a href="#restart"><u><font color="#0066bb">プロセス再起動</font></u></a>の判断を仰いで下さい</b></font>

<b>(1)サービス確認</b>

    <b><a href="#service"><u><font color="#0066bb">サービス確認</font></u></a></b>を実施
　　　 確認した結果、「レスポンスが遅い」または「同じサーバからの警報が頻発する」場合。次項（2）に進む

<!-------------------->
<b>(2)名前解決(dig)のレスポンスが遅い もしくは 警報が頻発する場合</b>

　　a) 該当サーバにログインし　topコマンド（確認方法は<b><a href="#top"><u><font color="#0066bb">こちら</font></u></a></b>を実施）でMemory値を見る
　　b) 確認した結果、Memory値が下がらない場合は(3)に進む

<!-------------------->
<b>(3)Memory値が下がらない場合</b>

　　　
　　　memoryが95%以上を継続し、今までの対応でMemory値が下がらない場合はDNS班エスカレーションのうえ<b><a href="#restart"><u><font color="#0066bb">named または cacheserve/statmon/snmpagent の再起動</font></u></b></a>を行う
    <strong><font color="red">※<a href="http://XXXXX.html" target="_blank"><u><font color="#0066bb">サーバ一覧表</font></u></a>にSOidの記載があるサーバはAM0:00～0:30頃で夜間SOバッチが走っている場合がありますので、該当の時間帯の作業は避けてください
　　　(バッチが終了するまで待ってからrestart対応となります。DNS班に相談のうえ実施してください)</font></strong>
    <font size="2">※<font color="blue">ルータ輪番へnamed restartした旨の連絡</font>をする（ルータ輪番のログチェック作業にhealth check NGが現れる為）
　　　　　-----------------------------------------------
　　　　　ルータ輪番さま
　　　　　本日下記の時間にnamedの再起動を行いました
　　　　　SI,またはAXのHealth Check NGが発生している場合があります
　　　　　server : 2007/04/02 07:12 
　　　　　-----------------------------------------------</font>

<a name="#restart">
<font size="6"><b>★プロセスリスタート手順 </b></font><font color="red">※夜間帯実施する場合は、SOが動作しているAM0:00～0:30頃を避けて実施してください。</font>
<Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>

<b><a href="#process"><u><font color="#0066bb">[プロセス確認]</font></u></b></a>を実施後

以下、再起動するプロセスを確認の上実行。

■namedの再起動方法
<Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>
<font size="2">
<b>【<a href="http://XXXXXXX.html">Linux</a>：named再起動手順】</b>
# <font color="red">date;systemctl restart named </font>
# <font color="red">date;systemctl status named  </font>
<font color="#00ff00">●</font> named.service - Berkeley Internet Name Domain (DNS)
   Loaded: loaded (/etc/systemd/system/named.service; enabled; vendor preset: disabled)
	Active: <font color="#00ff00">active (running)</font> since Fri 2020-02-14 11:38:51 JST; 3s ago
	
	 ～～～～～～～～～～～～～～～～～～～(省略)～～～～～～～～～～～～～～～～～～～～～
	 
	 
# <font color="red">ps -ef | grep named | grep -v grep </font>
named    14825     1  0  2009 ?        00:00:05 /usr/sbin/named -u named

※再起動後、namedサービスのプロセス確認をしてください。

</font></Pre></Td></Tr>
</Table>

<a name="cacheserve"></a>
■cacheserveの再起動方法
<Table Width="90%" align="center" Border cellpadding="5"><Tr><Td><Pre>
<font size="2">
<b>【cacheserve再起動手順】</b>
【例　】<font color="red"><b>※必要プロセスが三つあるためそれぞれ起動させる(cacheserve/statmon/snmpagent)</b></font>

<b>#cacheserve再起動</b>
# <font color="red">date;systemctl restart cacheserve </font>
# <font color="red">date;systemctl status cacheserve </font>
※「Active: <font color="#00ff00">active (running)</font>」となっていればOK

<b>#statmon再起動</b>
# <font color="red">date;systemctl restart statmon </font>
# <font color="red">date;systemctl status statmon </font>
※「Active: <font color="#00ff00">active (running)</font>」となっていればOK

<b>#snmpagent再起動</b>
# <font color="red">date;systemctl restart snmpagent </font>
# <font color="red">date;systemctl status snmpagent </font>
※「Active: <font color="#00ff00">active (running)</font>」となっていればOK


# ps -ef | grep -e cacheserve -e statmon -e snmpagent | grep -v grep
root      2131     1  0  2016 ?        00:00:41 /usr/local/nom/sbin/cacheserve --syslog-facility local5
root      2132  2131 32  2016 ?        380-05:42:49 /usr/local/nom/sbin/cacheserve --syslog-facility local5
root      2184     1  8  2016 ?        98-11:17:22 cacheserve-statmon: running
root     35657     1  0  2017 ?        00:00:00 snmpagent: fsyncer
root     35658     1  0  2017 ?        04:12:02 snmpagent: subagent (running)

※再起動後、プロセス確認してください。

<b>AAAAフィルタの確認</b>
cacheserveサーバではAAAAフィルタがONかOFFかをご確認ください
<font color="red">起動プロセス項目にAAAA-Filterと記載のあるサーバはONになっていなければならないサーバです</font><b><a href="http://XXXXX.html">サーバ一覧はこちら</a></b>
【確認方法】
⇒　# /opt/SHELL/aaaa-filter-cs.sh status
Filter-aaaa-on-v4 is ... DISABLED (Filter object DOES NOT exist).				←OFFです
Filter-aaaa-on-v4 is ... ENABLED								←ONです

もしサーバ一覧の起動プロセス項目と異なり起動していない/起動しているサーバがあれば変更の以下がON/OFFの手順ですので状況に合わせて実施してください

# /opt/SHELL/aaaa-filter-cs.sh off ※OFFにしなければいけないサーバ用
# /opt/SHELL/aaaa-filter-cs.sh on  ※ONにしなければいけないサーバ用

# /opt/SHELL/aaaa-filter-cs.sh status
上記ステータスを確認し起動プロセスの通り設定されていればOKです。

以上の手順を実施しサービス確認(dig)で問題がなければ完了です。


</font></Pre></Td></Tr>
</Table>

    <font color="red">【注意】namedが起動していない場合、cronで自動起動します。cacheserveについてはcronでの自動起動はしません
         もしプロセス起動確認時に2重起動している場合は、上記のプロセス確認のように正常に起動させるようにしてください。</font>

</pre></Td></Tr>
    </Table>



    </pre>
</body>
</html>
